<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>TIMEMARK PRICING</title>

<style>
body{
  margin:0;
  font-family:Arial;
  background:linear-gradient(135deg,#0b1d3a,#4a00e0,#8e2de2);
  min-height:100vh;
  color:#fff;
}

.header{
  text-align:center;
  padding:30px 10px;
}

.container{
  max-width:900px;
  margin:auto;
  display:flex;
  gap:20px;
  flex-wrap:wrap;
  justify-content:center;
}

.card{
  width:260px;
  border-radius:18px;
  padding:22px;
  backdrop-filter:blur(16px);
  background:rgba(255,255,255,0.08);
  box-shadow:0 20px 40px rgba(0,0,0,.4);
  text-align:center;
  transition:.3s;
}
.card:hover{
  transform:translateY(-8px);
}

.basic{border:2px solid #00e676;}
.pro{border:2px solid #00b0ff;}
.premium{border:2px solid #ff00ff;}

h3{margin-top:0}

.price{
  font-size:18px;
  margin:10px 0;
  line-height:1.8;
}

button{
  width:100%;
  padding:12px;
  border:none;
  border-radius:10px;
  font-weight:bold;
  cursor:pointer;
  background:linear-gradient(135deg,#ff6a00,#ff9800);
  color:#fff;
}
button:hover{opacity:.9}

.footer{
  text-align:center;
  margin-top:30px;
  opacity:.7;
}
</style>
</head>


<body>
<div id="qrPopup" style="
position:fixed;
inset:0;
background:rgba(0,0,0,.75);
display:none;
align-items:center;
justify-content:center;
z-index:99999;
">

  <div style="
    background:#111;
    padding:20px;
    border-radius:14px;
    text-align:center;
    width:300px;
  ">

    <h3>QuÃ©t QR Ä‘á»ƒ thanh toÃ¡n</h3>

    <img id="qrImg" src="" style="
      width:220px;
      border-radius:10px;
      margin:12px 0;
    ">

    <div id="loadingText" style="opacity:.8">
      â³ Äang chá» thanh toÃ¡n...
    </div>

  </div>
</div>

<div class="header">
  <h1>ğŸš€ TIMEMARK PREMIUM</h1>
  <p>Chá»n gÃ³i báº£n quyá»n phÃ¹ há»£p</p>
</div>

<div class="container">

  <div class="card basic">
    <h3>âš¡ 1 NGÃ€Y</h3>
    <div class="price">39.000Ä‘</div>
    <button onclick="buy('basic1')">MUA NGAY</button>
  </div>

  <div class="card basic">
    <h3>ğŸŒ± 7 NGÃ€Y</h3>
    <div class="price">199.000Ä‘</div>
    <button onclick="buy('basic7')">MUA NGAY</button>
  </div>

  <div class="card pro">
    <h3>â­ 1 THÃNG</h3>
    <div class="price">699.000Ä‘</div>
    <button onclick="buy('pro1')">MUA NGAY</button>
  </div>

  <div class="card pro">
    <h3>ğŸ”¥ 3 THÃNG</h3>
    <div class="price">1.399.000Ä‘</div>
    <button onclick="buy('pro3')">MUA NGAY</button>
  </div>

  <div class="card premium">
    <h3>ğŸš€ 6 THÃNG</h3>
    <div class="price">2.199.000Ä‘</div>
    <button onclick="buy('pre6')">MUA NGAY</button>
  </div>

  <div class="card premium">
    <h3>ğŸ’ VÄ¨NH VIá»„N</h3>
    <div class="price">2.999.000Ä‘</div>
    <button onclick="buy('lifetime')">MUA NGAY</button>
  </div>

</div>


<div class="footer">
Má»—i key dÃ¹ng cho 1 thiáº¿t bá»‹
</div>

<script>
let checkTimer = null;
function startChecking(email){

  if(checkTimer) clearInterval(checkTimer);

  checkTimer = setInterval(()=>{

    fetch("https://script.google.com/macros/s/AKfycbwDRIc7_SZC2nx1TlYRU-taklWN57lDF9aXLHt2LE3MrLDEu-7Q0inQQlvYd6MKplhw9Q/exec",{
      method:"POST",
      body:JSON.stringify({
        action:"checkPaid",
        email:email
      })
    })
    .then(r=>r.json())
    .then(res=>{

      if(res.paid){

        clearInterval(checkTimer);

        document.getElementById("qrPopup").style.display="none";

        alert("ğŸ‰ Thanh toÃ¡n thÃ nh cÃ´ng! KEY Ä‘Ã£ gá»­i vá» email.");

      }

    });

  },3000);
}

// ====== PRICE MAP THEO LOGIC APP HIá»†N Táº I ======
const priceMap = {
  basic1: 39000,
  basic7: 199000,
  pro1: 699000,
  pro3: 1399000,
  pre6: 2199000,
  lifetime: 2999000
};


/* =========================
   â­ CHECK LOCK BUY PAGE
========================= */

fetch("https://script.google.com/macros/s/AKfycbwDRIc7_SZC2nx1TlYRU-taklWN57lDF9aXLHt2LE3MrLDEu-7Q0inQQlvYd6MKplhw9Q/exec",{
  method:"POST",
  body:JSON.stringify({
    action:"checkLock"
  })
})
.then(r=>r.json())
.then(res=>{

  console.log("LOCK STATUS:",res);

  if(res.lock){

    document.querySelectorAll("button").forEach(btn=>{
      btn.disabled = true;
      btn.innerText = "ğŸ”’ Äang cáº­p nháº­t thanh toÃ¡n";
      btn.style.opacity = "0.5";
      btn.style.cursor = "not-allowed";
    });

    document.getElementById("toastLock").style.display="block";
  }

});




function buy(plan){

  const email = prompt("Nháº­p Gmail Ä‘á»ƒ nháº­n KEY:");

  if(!email){
    alert("Báº¡n chÆ°a nháº­p Gmail");
    return;
  }

  if(!email.includes("@")){
    alert("Email khÃ´ng há»£p lá»‡");
    return;
  }

  const price = priceMap[plan];

// â­ Ná»™i dung chuyá»ƒn khoáº£n má»›i (khá»›p webhook)
const orderId = plan.toUpperCase();

const qrLink =
"https://img.vietqr.io/image/970415-104882732682-compact2.png?amount="
+price+
"&addInfo="+encodeURIComponent(orderId)+
"&accountName="+encodeURIComponent("TIMEMARK");

  // â­ HIá»†N POPUP QR
  document.getElementById("qrPopup").style.display="flex";
  document.getElementById("qrImg").src = qrLink;
document.getElementById("loadingText").innerText = "â³ Äang chá» thanh toÃ¡n...";


  // â­ Táº O DÃ’NG CHá»œ
  fetch("https://script.google.com/macros/s/AKfycbwDRIc7_SZC2nx1TlYRU-taklWN57lDF9aXLHt2LE3MrLDEu-7Q0inQQlvYd6MKplhw9Q/exec",{
  method:"POST",
  body:JSON.stringify({
    action:"createPending",
    email:email
  })
})
.then(()=>{

  // â­ CHá»ˆ CHECK SAU KHI Táº O DÃ’NG CHá»œ XONG
  startChecking(email);

});

}

</script>
<div id="toastLock" style="
position:fixed;
top:20px;
left:50%;
transform:translateX(-50%);
background:rgba(0,0,0,0.85);
color:#fff;
padding:12px 18px;
border-radius:10px;
font-size:14px;
display:none;
z-index:9999;
backdrop-filter:blur(8px);
">
ğŸ”’ Trang mua key Ä‘ang táº¡m khÃ³a
</div>


</body>
</html>
